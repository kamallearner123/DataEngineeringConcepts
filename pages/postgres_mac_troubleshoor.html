<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix PostgreSQL Brew Services Error on macOS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1, h2, h3 {
            color: #333;
        }
        code {
            background-color: #eee;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
        }
        pre {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        pre code {
            background: none;
            padding: 0;
        }
        ul, ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        li {
            margin-bottom: 8px;
        }
        .note {
            background-color: #fff3cd;
            padding: 10px;
            border-left: 4px solid #ffca28;
            margin: 10px 0;
        }
        .section {
            background-color: #fff;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>Fix PostgreSQL Brew Services Error on macOS</h1>
    <p>The error <code>Bootstrap failed: 5: Input/output error</code> when running <code>brew services start postgresql</code> indicates a <code>launchctl</code> issue with Homebrew's service management. This guide resolves the problem for your <strong>SmartTracker</strong> Django project, ensuring PostgreSQL starts reliably for use with Gunicorn.</p>

    <div class="section">
        <h2>Step-by-Step Resolution</h2>

        <h3>1. Confirm PostgreSQL Installation</h3>
        <p>Verify which PostgreSQL version is installed, as the error references <code>postgresql@14</code>.</p>
        <ul>
            <li>Check installed versions:
                <pre><code>brew list | grep postgresql</code></pre>
            </li>
            <li>If <code>postgresql@14</code> or <code>postgresql</code> is missing, reinstall:
                <pre><code>brew install postgresql  # Latest version (recommended)
# OR
brew install postgresql@14  # For version 14</code></pre>
            </li>
        </ul>

        <h3>2. Stop Any Running PostgreSQL Processes</h3>
        <p>Existing processes may conflict with the service startup.</p>
        <ul>
            <li>Check for processes:
                <pre><code>ps aux | grep postgres</code></pre>
            </li>
            <li>Stop them:
                <pre><code>pg_ctl -D /opt/homebrew/var/postgres stop  # Latest PostgreSQL
# OR
pg_ctl -D /opt/homebrew/var/postgresql@14 stop  # postgresql@14</code></pre>
            </li>
            <li>If stop fails, kill processes:
                <pre><code>pkill -u postgres</code></pre>
            </li>
        </ul>

        <h3>3. Fix the <code>launchctl</code> Bootstrap Error</h3>
        <p>The error points to <code>homebrew.mxcl.postgresql@14.plist</code> in <code>~/Library/LaunchAgents</code>.</p>
        <ul>
            <li>Remove problematic plist:
                <pre><code>rm ~/Library/LaunchAgents/homebrew.mxcl.postgresql@14.plist
rm ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist  # If using latest</code></pre>
            </li>
            <li>Unload stale services:
                <pre><code>launchctl remove homebrew.mxcl.postgresql@14
launchctl remove homebrew.mxcl.postgresql</code></pre>
            </li>
            <li>Restart the service:
                <pre><code>brew services start postgresql  # Latest
# OR
brew services start postgresql@14  # postgresql@14</code></pre>
            </li>
            <li>If it fails, run as root:
                <pre><code>sudo brew services start postgresql  # or postgresql@14</code></pre>
            </li>
        </ul>

        <h3>4. Fix Permissions</h3>
        <p>Ensure correct permissions for LaunchAgents and data directories.</p>
        <ul>
            <li>LaunchAgents:
                <pre><code>sudo chown -R $(whoami):staff ~/Library/LaunchAgents
chmod -R 700 ~/Library/LaunchAgents</code></pre>
            </li>
            <li>Data directory:
                <pre><code>sudo chown -R $(whoami):staff /opt/homebrew/var/postgres
sudo chmod -R 700 /opt/homebrew/var/postgres
# OR
sudo chown -R $(whoami):staff /opt/homebrew/var/postgresql@14
sudo chmod -R 700 /opt/homebrew/var/postgresql@14</code></pre>
            </li>
        </ul>

        <h3>5. Manually Start PostgreSQL</h3>
        <p>Bypass <code>brew services</code> if it fails.</p>
        <ul>
            <li>Start:
                <pre><code>pg_ctl -D /opt/homebrew/var/postgres start  # Latest
# OR
pg_ctl -D /opt/homebrew/var/postgresql@14 start  # postgresql@14</code></pre>
            </li>
            <li>Verify:
                <pre><code>ps aux | grep postgres
psql -d postgres -U $(whoami)</code></pre>
                <p>If <code>postgres=#</code> appears, exit with <code>\q</code>.</p>
            </li>
        </ul>

        <h3>6. Reinitialize the Database (If Necessary)</h3>
        <p>If startup fails, reinitialize the database cluster.</p>
        <ul>
            <li>Stop PostgreSQL:
                <pre><code>pg_ctl -D /opt/homebrew/var/postgres stop  # or /opt/homebrew/var/postgresql@14</code></pre>
            </li>
            <li>Remove data directory (back up first):
                <pre><code>rm -rf /opt/homebrew/var/postgres  # or /opt/homebrew/var/postgresql@14</code></pre>
            </li>
            <li>Reinitialize:
                <pre><code>initdb /opt/homebrew/var/postgres  # or /opt/homebrew/var/postgresql@14</code></pre>
            </li>
            <li>Restart:
                <pre><code>pg_ctl -D /opt/homebrew/var/postgres start  # or /opt/homebrew/var/postgresql@14</code></pre>
            </li>
        </ul>

        <h3>7. Check Logs for Errors</h3>
        <p>Inspect logs for detailed errors.</p>
        <ul>
            <li>View logs:
                <pre><code>cat /opt/homebrew/var/log/postgres.log  # Latest
# OR
cat /opt/homebrew/var/log/postgresql@14.log  # postgresql@14</code></pre>
            </li>
            <li>Fix common issues:
                <ul>
                    <li><strong>Port Conflict</strong>: Check port 5432:
                        <pre><code>lsof -i :5432</code></pre>
                        Edit <code>postgresql.conf</code> to change port (e.g., 5433):
                        <pre><code>nano /opt/homebrew/var/postgres/postgresql.conf</code></pre>
                    </li>
                    <li><strong>Permissions</strong>: Reapply permissions (see Step 4).</li>
                </ul>
            </li>
        </ul>

        <h3>8. Reinstall Homebrew Services</h3>
        <p>If <code>launchctl</code> issues persist, reinstall services.</p>
        <ul>
            <li>Reinstall:
                <pre><code>brew tap homebrew/services
brew services restart postgresql  # or postgresql@14</code></pre>
            </li>
        </ul>

        <h3>9. Fallback: Manual Startup</h3>
        <p>Use manual startup for <strong>SmartTracker</strong> until <code>brew services</code> is fixed.</p>
        <ul>
            <li>Start:
                <pre><code>pg_ctl -D /opt/homebrew/var/postgres start  # or /opt/homebrew/var/postgresql@14</code></pre>
            </li>
            <li>Stop:
                <pre><code>pg_ctl -D /opt/homebrew/var/postgres stop  # or /opt/homebrew/var/postgresql@14</code></pre>
            </li>
        </ul>

        <h3>10. Configure Django and Gunicorn</h3>
        <p>Connect <strong>SmartTracker</strong> to PostgreSQL.</p>
        <ul>
            <li>Update <code>settings.py</code>:
                <pre><code>DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'postgres',  # or custom name
        'USER': 'kamalmukiri',
        'PASSWORD': '',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}</code></pre>
            </li>
            <li>Create database:
                <pre><code>psql -d postgres
CREATE DATABASE smarttracker;
\q</code></pre>
            </li>
            <li>Run migrations:
                <pre><code>pip install psycopg2-binary
python manage.py makemigrations
python manage.py migrate</code></pre>
            </li>
            <li>Test Gunicorn:
                <pre><code>gunicorn --workers 3 --bind 0.0.0.0:8000 SmartTracker.wsgi:application</code></pre>
            </li>
        </ul>
    </div>

    <div class="section">
        <h2>Troubleshooting Persistent Issues</h2>
        <p>If the error persists, provide:</p>
        <ul>
            <li>Output of <code>sudo brew services start postgresql</code> (or <code>postgresql@14</code>).</li>
            <li>LaunchAgents contents:
                <pre><code>ls -la ~/Library/LaunchAgents</code></pre>
            </li>
            <li>Logs:
                <pre><code>cat /opt/homebrew/var/log/postgres.log  # or /opt/homebrew/var/log/postgresql@14.log</code></pre>
            </li>
            <li>PostgreSQL version:
                <pre><code>psql --version</code></pre>
            </li>
        </ul>
    </div>

    <div class="section">
        <h2>Alternative: Use Postgres.app</h2>
        <p>If Homebrew fails, try <a href="https://postgresapp.com/">Postgres.app</a>.</p>
        <ul>
            <li>Download and install.</li>
            <li>Open and click “Initialize”.</li>
            <li>Connect: <code>psql -d postgres -h localhost</code>.</li>
            <li>Update Django <code>settings.py</code> for <code>localhost:5432</code>.</li>
        </ul>
    </div>

    <div class="note">
        <h3>Notes</h3>
        <ul>
            <li><strong>Apple Silicon</strong>: Use <code>/opt/homebrew/</code>. For Intel, use <code>/usr/local/</code>.</li>
            <li><strong>Error Context</strong>: The <code>Bootstrap failed: 5</code> likely stems from a corrupted plist or <code>launchctl</code> issue.</li>
            <li><strong>Productivity</strong>: Block YouTube (e.g., with <a href="https://getcoldturkey.com/">Cold Turkey</a>) to focus on <strong>SmartTracker</strong>.</li>
        </ul>
    </div>

    <p>PostgreSQL should now run, either via <code>brew services</code> or manually, for your Django project. For further errors, share the outputs above. Next steps: Gunicorn deployment or other <strong>SmartTracker</strong> tasks.</p>
</body>
</html>
